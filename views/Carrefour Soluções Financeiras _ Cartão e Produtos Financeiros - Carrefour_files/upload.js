AUI.add("document-library-upload",function(w){var D=w.Array;var aj=w.Lang;var ah=aj.String;var X=Liferay.HistoryManager;var v=w.Uploader.Queue;var K=aj.sub;var W=w.config.doc;var T=w.UA;var L="active-area";var b="app-view-entry-taglib";var x=".column-content";var u="entry-display-style";var ag="icon";var f="taglib-icon";var C="taglib-text";var z="upload-error";var y="upload-success";var Z="upload-warning";var ai=1;var k=themeDisplay.getPathThemeImages();var U=/\.(aac|auif|bwf|flac|mp3|mp4|m4a|wav|wma)$/i;var N=/\.(dmg|gz|tar|tgz|zip)$/i;var s=/\.(bmp|gif|jpeg|jpg|png|tiff)$/i;var r=/\.(avi|flv|mpe|mpg|mpeg|mov|m4v|ogg|wmv)$/i;var d='[data-folder="true"]';var Y='[data-folder="true"][data-title]';var J=".display-descriptive";var ad=".display-icon";var g=".document-entries-pagination";var V=".entries-empty";var E=".entry-link";var c=".entry-title-text";var p=".lfr-header-row";var e="img.icon";var l=".searchcontainer";var S=".";var af=S+u;var Q=S+f;var ae=1024;var I="boundingBox";var t="contentBox";var P=".pdf";var O="first";var ab="list";var i="#FFF";var ac="k";var n="MB";var j="GB";var m=" ";var M=".png";var q="default"+M;var G="pdf"+M;var aa="music"+M;var a="compressed"+M;var F="video"+M;var o=k+"/file_system/large/";var h=w.Uploader.TYPE||"none";var R='<span class="'+b+m+u+'"><a class="'+f+'"><img alt="" class="'+ag+'" src="'+k+'/file_system/small/page.png" /><span class="'+C+'">{0}</span></a></span>';var H=new w.Template('<span class="lfr-status-success-label">{validFilesLength}</span>','<span class="lfr-status-error-label">{invalidFilesLength}</span>','<ul class="unstyled">','<tpl for="invalidFiles">',"<li><b>{name}</b>: {errorMessage}</li>","</tpl>","</ul>");var B=themeDisplay.getPathContext()+"/documents/"+themeDisplay.getScopeGroupId()+"/{0}/{1}";DocumentLibraryUpload=function(){};DocumentLibraryUpload.NAME="documentlibraryupload";DocumentLibraryUpload.prototype={initializer:function(){var A=this;if(themeDisplay.isSignedIn()&&(h==="html5")&&!T.touch&&A.one("#addButtonContainer")){A._initDLUpload()}},destructor:function(){var A=this;if(A._dataSet){A._dataSet.destroy()}if(A._navigationOverlays){D.invoke(A._navigationOverlays,"destroy")}if(A._overlayManager){A._overlayManager.destroy()}if(A._uploader){A._uploader.destroy()}A._detachSubscriptions();if(A._tooltipDelegate){A._tooltipDelegate.destroy()}},_addFilesToQueueBottom:function(al){var ak=this;var A=ak._getUploader().queue;D.each(al,function(an,am,ao){A.addToQueueBottom(an)})},_attachEventHandlers:function(){var at=this;var am=w.one(W.documentElement);var an=at._entriesContainer;var A=at.ns("folderId");w.getWin()._node.onbeforeunload=w.bind("_confirmUnload",at);var aq=Liferay.on(at.ns("dataRequest"),at._onDataRequest,at);var ap=Liferay.after("liferay-app-view-folders:dataRequest",function(aw){var ax=aw.requestParams;at._folderId=ax[A]},at);var av=w.debounce(function(){am.removeClass("upload-drop-intent");am.removeClass("upload-drop-active")},500);var au=at._appViewMove._ddHandler.dd;au.addInvalid(S+z);var al=am.on("dragover",function(aw){var ay=aw._event.dataTransfer;if(ay&&ay.types){var ax=ay.types||[];if((D.indexOf(ax,"Files")>-1)&&(D.indexOf(ax,"text/html")===-1)){aw.halt();ay.dropEffect="copy";am.addClass("upload-drop-intent");var az=aw.target;am.toggleClass("upload-drop-active",(az.compareTo(an)||an.contains(az)));av()}}});var ak=am.delegate("drop",function(ax){var az=ax._event.dataTransfer;if(az){var ay=az.types||[];if((D.indexOf(ay,"Files")>-1)&&(D.indexOf(ay,"text/html")===-1)){ax.halt();var aw=D(az.files);ax.fileList=D.map(aw,function(aC,aB,aD){return new w.FileHTML5(aC)});var aA=at._getUploader();aA.fire("fileselect",ax)}}},'body, .document-container, .overlaymask, .progressbar, [data-folder="true"]');var ar=an.delegate(["dragleave","dragover"],function(ax){var az=ax._event.dataTransfer;var ay=az.types;if((D.indexOf(ay,"Files")>-1)&&(D.indexOf(ay,"text/html")===-1)){var aw=ax.target.ancestor(af);aw.toggleClass(L,ax.type=="dragover")}},d);var ao=an.delegate("click",function(aw){aw.preventDefault()},S+z+m+E);at._handles.push(ap,ao,ar,aq,al,ak)},_attachSubscriptions:function(am){var A=this;var al=A._handles;var an=A._getUploader();var ak=A._getDisplayStyle();if(am.folder){al.push(an.on("uploadstart",A._showFolderUploadStarting,A,am),an.on("totaluploadprogress",A._showFolderUploadProgress,A,am),an.on("uploadcomplete",A._detectFolderUploadError,A,am),an.on("alluploadscomplete",A._showFolderUploadComplete,A,am,ak))}else{al.push(an.after("fileuploadstart",A._showFileUploadStarting,A),an.on("uploadprogress",A._showFileUploadProgress,A),an.on("uploadcomplete",A._showFileUploadComplete,A,ak))}},_combineFileLists:function(ak,al){var A=this;D.each(al,function(an,am,ao){ak.push(an)})},_confirmUnload:function(){var A=this;if(A._isUploading()){return'\u0055\u0070\u006c\u006f\u0061\u0064\u0073\u0020\u0065\u0073\u0074\u00e3\u006f\u0020\u0065\u006d\u0020\u0070\u0072\u006f\u0067\u0072\u0065\u0073\u0073\u006f\u002e\u0020\u0053\u0065\u0020\u0076\u006f\u0063\u00ea\u0020\u0064\u0065\u0069\u0078\u0061\u0072\u0020\u0065\u0073\u0074\u0061\u0020\u0070\u00e1\u0067\u0069\u006e\u0061\u002c\u0020\u0061\u006c\u0067\u0075\u006e\u0073\u0020\u0075\u0070\u006c\u006f\u0061\u0064\u0073\u0020\u0070\u006f\u0064\u0065\u006d\u0020\u006e\u00e3\u006f\u0020\u0073\u0065\u0020\u0063\u006f\u006d\u0070\u006c\u0065\u0074\u0061\u0072\u002e'}},_createEntryNode:function(A,at,ar){var ap=this;var ao;var al;if(ar==ab){var an=ap._entriesContainer.one(l);al=an.one("tbody");ao=ap._createEntryRow(A,at)}else{var am=ap._invisibleDescriptiveEntry;if(ar===ag){am=ap._invisibleIconEntry}ao=am.clone();var ak=ao.one(E);var aq=ak.one(c);al=ap._entriesContainer;ak.attr("title",A);aq.setContent(A)}ao.attr({"data-title":A,id:w.guid()});al.append(ao);ao.show().scrollIntoView();return ao},_createEntryRow:function(al,am){var A=this;var an=A._formatStorageSize(am);var ak=A._entriesContainer.one(l);var ap=Liferay.SearchContainer.get(ak.attr("id"));var aq=D.map(A._columnNames,function(at,ar,av){var au="";if(at=="name"){au=K(R,[al])}else{if(at=="size"){au=an}else{if(at=="downloads"){au="0"}}}return au});var ao=ap.addRow(aq,w.guid());ao.attr("data-draggable",true);return ao},_createOverlay:function(am,al){var A=this;var ak=new w.OverlayMask({background:al||null,target:am}).render();ak.get(I).addClass("portlet-document-library-upload-mask");return ak},_createProgressBar:function(){var ak=this;var am=ak._dimensions;var A=am.height/5;var al=am.width/0.64;return new w.ProgressBar({height:A,on:{complete:function(an){this.set("label","complete!")},valueChange:function(an){this.set("label",an.newVal+"%")}},width:al})},_createUploadStatus:function(an,al){var A=this;var ak=A._createOverlay(an);var am=A._createProgressBar();ak.show();if(al){al.overlay=ak;al.progressBar=am;al.target=an}else{an.overlay=ak;an.progressBar=am}},_destroyEntry:function(){var ak=this;var A=ak._getCurrentUploadData();var al=A.fileList;if(!A.folder){D.each(al,function(an,am,ao){an.overlay.destroy();an.progressBar.destroy()})}D.invoke(al,"destroy")},_detachSubscriptions:function(){var A=this;var ak=A._handles;D.invoke(ak,"detach");ak.length=0},_detectFolderUploadError:function(am,an){var A=this;var ak=A._getUploadResponse(am.data);if(ak.error){var al=am.file;al.errorMessage=ak.message;an.invalidFiles.push(al)}},_displayEntryError:function(am,al,ak){var A=this;if(ak===ab){var an=am.one(e);an.attr("src",k+"/common/close.png")}else{am.addClass(z)}A._displayError(am,al)},_displayError:function(am,al){var A=this;am.attr("data-message",al);var ak=A._tooltipDelegate;if(!ak){ak=new w.TooltipDelegate({formatter:function(){var ao=this;ao.set("zIndex",2);var an=ao.get("trigger");return an.attr("data-message")},trigger:".app-view-entry.upload-error",visible:false});A._tooltipDelegate=ak}return am},_displayResult:function(ao,am,an){var ak=this;var al=ao;if(al){var A=y;if(an){al.removeClass(z).removeClass(Z);if(an===true){A=z}else{if(an===ai){A=Z}}}al.addClass(A)}},_formatStorageSize:function(al){var A=this;var am=ac;al/=ae;if(al>ae){am=n;al/=ae}if(al>ae){am=j;al/=ae}var ak=1;if(am==ac){ak=0}return ah.round(al,ak)+am},_getCurrentUploadData:function(){var ak=this;var al=ak._getDataSet();var A=al.get(O);return A},_getDataSet:function(){var A=this;var ak=A._dataSet;if(!ak){ak=new w.DataSet();A._dataSet=ak}return ak},_getDisplayStyle:function(am){var A=this;var al=A.ns("displayStyle");var ak=X.get(al)||A._config.displayStyle;if(am){ak=(am==ak)}return ak},_getEmptyMessage:function(){var A=this;var ak=A._emptyMessage;if(!ak){ak=A._entriesContainer.one(V);A._emptyMessage=ak}return ak},_getFolderEntryNode:function(am){var A=this;var an;var al=am.hasClass("overlay-content");if(al){var ak=w.Widget.getByNode(am);an=ak._originalConfig.target}else{if(am.attr("data-folder")=="true"){an=am}if(!an){an=am.ancestor(E+d)}if(!an){an=am.ancestor(Y)}an=an&&an.ancestor()}return an},_getFolderId:function(al){var A=this;var am=A._getFolderEntryNode(al);var ak=am&&am.one("[data-folder-id]");return(ak&&w.Lang.toInt(ak.attr("data-folder-id"))||A._folderId)},_getMediaThumbnail:function(al){var A=this;var ak=q;if(s.test(al)){ak=K(B,[A._folderId,al])}else{if(ah.endsWith(al.toLowerCase(),P)){ak=G}else{if(U.test(al)){ak=aa}else{if(r.test(al)){ak=F}else{if(N.test(al)){ak=a}}}}ak=o+ak}return ak},_getNavigationOverlays:function(){var A=this;var ak=A._navigationOverlays;if(!ak){ak=[];var al=function(ao){if(ao){var an=A._createOverlay(ao,i);ak.push(an)}};var am=A.one("#documentLibraryContainer");al(am.one(g));al(am.one(".app-view-taglib.lfr-header-row"));al(A.byId("listViewContainer"));A._navigationOverlays=ak}return ak},_getUploadResponse:function(al){var A=this;var ak;var an;try{al=w.JSON.parse(al)}catch(am){}if(aj.isObject(al)){ak=al.status&&(al.status>=490&&al.status<500);if(ak){an=al.message}else{an=A.ns("fileEntryId=")+al.fileEntryId}}return{error:ak,message:an}},_getUploader:function(){var A=this;var al=A._uploader;if(!al){al=new w.Uploader({appendNewFiles:false,fileFieldName:"file",multipleFiles:true,simLimit:1});var ak=A._getNavigationOverlays();al.on("uploadstart",function(am){D.invoke(ak,"show")});al.after("alluploadscomplete",function(an){D.invoke(ak,"hide");var am=A._getEmptyMessage();if(am&&!am.hasClass("hide")){am.hide(true)}});al.get("boundingBox").hide();al.render();al.after("alluploadscomplete",A._startNextUpload,A);al.after("fileselect",A._onFileSelect,A);A._uploader=al}return al},_getUploadURL:function(ak){var A=this;var am=A._uploadURL;if(!am){var al=A._config;var an=al.redirect;am=unescape(al.uploadURL);A._uploadURL=Liferay.Util.addParams({redirect:an,ts:aj.now()},am)}return K(am,{folderId:ak})},_initDLUpload:function(){var A=this;var al=A._config;var an=al.maxFileSize;var am=al.folders;A._folderId=am.defaultParentFolderId;A._handles=[];A._attachEventHandlers();var ao=al.columnNames;ao.push("");ao.unshift("");A._columnNames=ao;A._dimensions=am.dimensions;A._tooltipDelegates=[];var ak=A.byId("appViewEntryTemplates");A._invisibleDescriptiveEntry=ak.one(af+J);A._invisibleIconEntry=ak.one(af+ad);A._maxFileSize=an;A._viewFileEntryURL=al.viewFileEntryURL;A._invalidFileSizeText='\u0050\u006f\u0072\u0020\u0066\u0061\u0076\u006f\u0072\u002c\u0020\u0069\u006e\u0073\u0069\u0072\u0061\u0020\u0075\u006d\u0020\u0061\u0072\u0071\u0075\u0069\u0076\u006f\u0020\u0063\u006f\u006d\u0020\u0075\u006d\u0020\u0074\u0061\u006d\u0061\u006e\u0068\u006f\u0020\u006d\u0065\u006e\u006f\u0072\u0020\u0071\u0075\u0065\u0020\u007b\u0030\u007d\u006b\u002e';A._zeroByteFileText='\u004f\u0020\u0061\u0072\u0071\u0075\u0069\u0076\u006f\u0020\u006e\u00e3\u006f\u0020\u0070\u006f\u0073\u0073\u0075\u0069\u0020\u0064\u0061\u0064\u006f\u0073\u0020\u0065\u0020\u0070\u006f\u0072\u0020\u0069\u0073\u0073\u006f\u0020\u006f\u0020\u0075\u0070\u006c\u006f\u0061\u0064\u0020\u006e\u00e3\u006f\u0020\u0070\u00f4\u0064\u0065\u0020\u0073\u0065\u0072\u0020\u0072\u0065\u0061\u006c\u0069\u007a\u0061\u0064\u006f\u002e\u0020\u0050\u006f\u0072\u0020\u0066\u0061\u0076\u006f\u0072\u002c\u0020\u0075\u0074\u0069\u006c\u0069\u007a\u0065\u0020\u006f\u0020\u0075\u0070\u006c\u006f\u0061\u0064\u0065\u0072\u0020\u0063\u006c\u00e1\u0073\u0073\u0069\u0063\u006f\u002e'},_isUploading:function(){var ak=this;var al=ak._uploader;var A=al&&al.queue;return!!(A&&(A.queuedFiles.length>0||A.numberOfUploads>0||!w.Object.isEmpty(A.currentFiles))&&A._currentState===v.UPLOADING)},_onDataRequest:function(ak){var A=this;if(A._isUploading()){ak.halt()}},_getUploadStatus:function(al){var A=this;var ak=A._getDataSet();return ak.item(String(al))},_onFileSelect:function(ak){var A=this;var am=ak.details[0].target;var al=A._validateFiles(ak.fileList);A._updateStatusUI(am,al);A._queueSelectedFiles(am,al)},_positionProgressBar:function(ak,al){var A=this;var am=al.get(I);al.render(ak.get(I));am.center(ak.get(t))},_queueSelectedFiles:function(ap,ao){var A=this;var an=A._getFolderId(ap);var aq=A._getUploadStatus(an);var al=ao.matches;if(aq){A._updateDataSetEntry(an,aq,al)}else{var am=A._getDataSet();var ak=null;if(an!=A._folderId){ak=A._getFolderEntryNode(ap)}am.add(an,{fileList:al,target:ak,folder:(an!=A._folderId),folderId:an,invalidFiles:ao.rejects})}if(!A._isUploading()){A._startUpload()}},_showFileUploadComplete:function(aq,am){var A=this;var ao=aq.file;var al=ao.target;var ak=A._getUploadResponse(aq.data);if(ak){var ap=!!ak.error;if(ap){A._displayEntryError(al,ak.message,am)}else{var an=(am===ab);if(!an){A._updateThumbnail(al,ao.name)}A._updateFileLink(al,ak.message,an)}A._displayResult(al,am,ap)}ao.overlay.hide()},_showFileUploadProgress:function(ak){var A=this;A._updateProgress(ak.file.progressBar,ak.percentLoaded)},_showFileUploadStarting:function(al){var A=this;var ak=al.file;A._positionProgressBar(ak.overlay,ak.progressBar)},_showFolderUploadComplete:function(ak,A,ar){var aq=this;var al=A.target;var an=A.invalidFiles;var am=an.length;var ao=A.fileList.length;var ap=(am!==0);if(ap&&am!==ao){ap=ai}aq._displayResult(al,ar,ap);if(ap){aq._displayError(al,H.parse({invalidFiles:an,invalidFilesLength:am,validFilesLength:ao-am}))}al.overlay.hide()},_showFolderUploadProgress:function(ak,al){var A=this;A._updateProgress(al.target.progressBar,ak.percentLoaded)},_showFolderUploadStarting:function(ak,am){var A=this;var al=am.target;A._positionProgressBar(al.overlay,al.progressBar)},_startNextUpload:function(al){var A=this;A._destroyEntry();var ak=A._getDataSet();ak.removeAt(0);if(ak.length){A._startUpload()}},_startUpload:function(){var A=this;var an=A._getCurrentUploadData();var ak=an.fileList;var am=A._getUploader();if(ak.length){var al=A._getUploadURL(an.folderId);A._attachSubscriptions(an);am.uploadThese(ak,al)}else{am.fire("alluploadscomplete")}},_updateDataSetEntry:function(an,ao,am){var ak=this;var A=ak._getCurrentUploadData();if(A.folderId==an){ak._addFilesToQueueBottom(am)}else{ak._combineFileLists(ao.fileList,am);var al=ak._getDataSet();al.replace(an,ao)}},_updateFileLink:function(an,ao,al){var ak=this;var A=E;if(al){A=af+m+Q}var am=an.one(A);if(am){am.attr("href",Liferay.Util.addParams(ao,ak._viewFileEntryURL))}},_updateProgress:function(al,ak){var A=this;al.set("value",Math.ceil(ak))},_updateThumbnail:function(al,an){var A=this;var am=al.one("img");var ak=A._getMediaThumbnail(an);am.attr("src",ak)},_updateStatusUI:function(aq,ap){var A=this;var ak=A._getFolderId(aq);var ao=(ak!==A._folderId);if(ao){var an=A._getFolderEntryNode(aq);var am=an.overlay;if(am){am.show();A._updateProgress(an.progressBar,0)}else{A._createUploadStatus(an)}an.removeClass(L)}else{var al=A._getDisplayStyle();D.map(ap.matches,function(ar){var at=A._createEntryNode(ar.name,ar.size,al);A._createUploadStatus(at,ar)});D.map(ap.rejects,function(ar){var at=A._createEntryNode(ar.name,ar.size,al);A._displayEntryError(at,ar.errorMessage,A._getDisplayStyle())})}},_validateFiles:function(al){var A=this;var am=A._maxFileSize;var ak=K(A._invalidFileSizeText,[am/1024]);return D.partition(al,function(aq,ao,ar){var an;var ap=aq.get("size")||0;if((am!==0)&&(ap>am)){an=ak}else{if(ap===0){an=A._zeroByteFileText}}aq.errorMessage=an;aq.size=ap;aq.name=aq.get("name");return!an})}};Liferay.DocumentLibraryUpload=DocumentLibraryUpload},"",{requires:["aui-data-set-deprecated","aui-overlay-manager-deprecated","aui-overlay-mask-deprecated","aui-progressbar","aui-template-deprecated","aui-tooltip","liferay-app-view-folders","liferay-app-view-move","liferay-app-view-paginator","liferay-app-view-select","liferay-search-container","uploader"]});