AUI.add("liferay-portlet-dynamic-data-lists",function(g){var f=g.Array;var i=g.DataType.DateMath;var j=g.Lang;var e=g.Lang.emptyFn;var m="_INSTANCE_";var b="_fieldsDisplay";var h=g.JSON;var o="-";var l="";var d=" ";var k=g.Component.create({NAME:"document-library-file-entry-cell-editor",EXTENDS:g.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input type="hidden" />',initializer:function(){var p=this;window[Liferay.Util.getPortletNamespace("166")+"selectDocumentLibrary"]=g.bind("_selectFileEntry",p)},getElementsValue:function(){var p=this;return p.get("value")},_defInitToolbarFn:function(){var p=this;k.superclass._defInitToolbarFn.apply(p,arguments);p.toolbar.add({on:{click:g.bind("_onClickChoose",p)},label:'\u0053\u0065\u006c\u0065\u0063\u0069\u006f\u006e\u0061\u0072'},1)},_onClickChoose:function(){var p=this;var q=Liferay.PortletURL.createURL(themeDisplay.getURLControlPanel());q.setParameter("groupId",themeDisplay.getScopeGroupId());q.setParameter("struts_action","/dynamic_data_mapping/select_document_library");q.setPortletId("166");q.setWindowState("pop_up");Liferay.Util.openWindow({id:"selectDocumentLibrary",title:'\u0044\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u006f\u0073\u0020\u0065\u0020\u004d\u00ed\u0064\u0069\u0061\u0073',uri:q.toString()})},_selectFileEntry:function(r,t,s,u,q){var p=this;p.selectedTitle=u;p.selectedURL=r;p.set("value",JSON.stringify({groupId:s,title:u,uuid:t,version:q}))},_syncFileLabel:function(t,s){var p=this;var r=p.get("contentBox");var q=r.one("a");if(!q){q=g.Node.create("<a></a>");r.prepend(q)}q.setAttribute("href",s);q.setContent(Liferay.Util.escapeHTML(t))},_uiSetValue:function(s){var p=this;if(s){var r=p.selectedTitle;var q=p.selectedURL;if(r&&q){p._syncFileLabel(r,q)}else{c.Util.getFileEntry(s,function(u){var t=c.Util.getFileEntryURL(u);p._syncFileLabel(u.title,t)})}}else{p._syncFileLabel(l,l);s=l}p.elements.val(s)}}});var n=g.Component.create({NAME:"link-to-page-cell-editor",EXTENDS:g.DropDownCellEditor,prototype:{OPT_GROUP_TEMPLATE:'<optgroup label="{label}">{options}</optgroup>',renderUI:function(r){var p=this;var q={};n.superclass.renderUI.apply(p,arguments);g.io.request(themeDisplay.getPathMain()+"/layouts_admin/get_layouts",{after:{success:function(){var s=g.JSON.parse(this.get("responseData"));if(s&&s.layouts){p._createOptionElements(s.layouts,q,l);p.set("options",q)}}},data:{cmd:"getAll",expandParentLayouts:true,groupId:themeDisplay.getScopeGroupId(),p_auth:Liferay.authToken,paginate:false}})},_createOptions:function(w){var p=this;var t=[];var q=[];g.each(w,function(A,z,B){var x={id:g.guid(),label:z,value:Liferay.Util.escapeHTML(JSON.stringify(A))};var y=q;if(A.privateLayout){y=t}y.push(j.sub(p.OPTION_TEMPLATE,x))});var r=p.OPT_GROUP_TEMPLATE;var v=j.sub(r,{label:'\u0050\u00e1\u0067\u0069\u006e\u0061\u0073\u0020\u0070\u00fa\u0062\u006c\u0069\u0063\u0061\u0073',options:q.join(l)});var s=j.sub(r,{label:'\u0050\u00e1\u0067\u0069\u006e\u0061\u0073\u0020\u0070\u0072\u0069\u0076\u0061\u0064\u0061\u0073',options:t.join(l)});var u=p.elements;u.setContent(v+s);p.options=u.all("option")},_createOptionElements:function(s,q,r){var p=this;f.each(s,function(u,t,v){q[r+u.name]={groupId:u.groupId,layoutId:u.layoutId,name:u.name,privateLayout:u.privateLayout};if(u.hasChildren){p._createOptionElements(u.children.layouts,q,r+o+d)}})},_uiSetValue:function(s){var p=this;var q=p.options;if(q&&q.size()){q.set("selected",false);if(j.isValue(s)){var r=c.Util.parseJSON(s);q.each(function(v,t,w){var u=c.Util.parseJSON(v.attr("value"));if((u.groupId===r.groupId)&&(u.layoutId===r.layoutId)&&(u.privateLayout===r.privateLayout)){v.set("selected",true)}})}}return s}}});var c=g.Component.create({ATTRS:{portletNamespace:{validator:j.isString,value:l},recordsetId:{validator:j.isNumber,value:0},structure:{validator:j.isArray,value:[]}},CSS_PREFIX:"table",DATATYPE_VALIDATOR:{date:"date","double":"number",integer:"digits","long":"digits"},EXTENDS:g.DataTable,NAME:g.DataTable.Base.NAME,TYPE_EDITOR:{checkbox:g.CheckboxCellEditor,"ddm-date":g.DateCellEditor,"ddm-decimal":g.TextCellEditor,"ddm-integer":g.TextCellEditor,"ddm-number":g.TextCellEditor,radio:g.RadioCellEditor,select:g.DropDownCellEditor,text:g.TextCellEditor,textarea:g.TextAreaCellEditor},prototype:{initializer:function(){var p=this;p._setDataStableSort(p.get("data"));p.set("scrollable",true);p.on("dataChange",p._onDataChange);p.on("model:change",p._onRecordUpdate)},addEmptyRows:function(q){var p=this;var r=p.get("columns");var t=p.get("data");var s=f.map(r,function(v,u,w){return v.key});t.add(c.buildEmptyRecords(q,s))},updateMinDisplayRows:function(r,s){var p=this;s=(s&&g.bind(s,p))||e;var q=p.get("recordsetId");Liferay.Service("/ddlrecordset/update-min-display-rows",{recordSetId:q,minDisplayRows:r,serviceContext:h.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId()})},s)},_afterActiveCellIndexChange:function(p){var A=this;var v=A.get("activeCell");var w=A.get("boundingBox");var u=w.one(".table-x-scroller");var y=A.highlight.get("activeBorderWidth")[0];var t=v.outerWidth()+y;var q=u.outerWidth();var z=v.get("offsetLeft");var s=u.get("scrollLeft");var r=z+t;var x=s;if((s+q)<r){x=r-q}else{if(z<s){x=z}}u.set("scrollLeft",x)},_normalizeRecordData:function(r){var p=this;var q=p.get("structure");var s=[];var t={};g.each(q,function(w,u,y){var v=w.type;var x=r.get(w.name);if(v==="ddm-link-to-page"){x=c.Util.parseJSON(x);delete x.name;x=h.stringify(x)}else{if((v==="radio")||(v==="select")){if(!j.isArray(x)){x=f(x)}x=h.stringify(x)}}t[w.name]=p._normalizeValue(x);s.push(w.name+m+p._randomString(8))});t[b]=s.join(",");delete t.displayIndex;delete t.recordId;return t},_normalizeValue:function(q){var p=this;return String(q)},_onDataChange:function(q){var p=this;p._setDataStableSort(q.newVal)},_onEditCell:function(p){var y=this;c.superclass._onEditCell.apply(y,arguments);var u=y.get("activeCell");var q=p.alignNode||u;var t=y.getColumn(q);var w=y.getRecord(q);var v=y.get("data");var r=y.get("recordsetId");var s=y.get("structure");var x=y.getEditor(w,t);if(x){x.setAttrs({data:v,record:w,recordsetId:r,structure:s,zIndex:Liferay.zIndex.OVERLAY})}},_onRecordUpdate:function(u){var p=this;if(!g.Object.owns(u.changed,"recordId")){var v=p.get("data");var t=p.get("recordsetId");var q=u.target;var s=q.get("recordId");var w=p._normalizeRecordData(q);var r=v.indexOf(q);if(s>0){c.updateRecord(s,r,w,true)}else{c.addRecord(t,r,w,function(x){if(x.recordId>0){q.set("recordId",x.recordId,{silent:true})}})}}},_randomString:function(r){var q=Math.random();var p=q.toString(36);return p.substring(r)},_setDataStableSort:function(q){var p=this;q.sort=function(r){if(this.comparator){r=r||{};var t=this._items.concat();g.ArraySort.stableSort(t,g.bind(this._sort,this));var s=g.merge(r,{models:t,src:"sort"});if(r.silent){this._defResetFn(s)}else{this.fire("reset",s)}}return this}}},addRecord:function(r,q,t,s){var p=this;s=(s&&g.bind(s,p))||e;Liferay.Service("/ddlrecord/add-record",{groupId:themeDisplay.getScopeGroupId(),recordSetId:r,displayIndex:q,fieldsMap:JSON.stringify(t),serviceContext:JSON.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId(),workflowAction:Liferay.Workflow.ACTION_PUBLISH})},s)},buildDataTableColumns:function(s,q,r){var p=this;f.each(s,function(E,y,x){var D=E.dataType;var C=E.label;var t=E.name;var A=E.type;E.key=t;var F=p.TYPE_EDITOR[A]||g.TextCellEditor;var u={elementName:t,validator:{rules:{}}};var z=E.required;var B;if(z){C+=" ("+'\u004f\u0062\u0072\u0069\u0067\u0061\u0074\u00f3\u0072\u0069\u006f'+")"}C=g.Escape.html(C);E.label=C;if(A==="checkbox"){u.options={"true":'\u0056\u0065\u0072\u0064\u0061\u0064\u0065\u0069\u0072\u006f'};u.inputFormatter=function(I){return String(I.length>0)};E.formatter=function(K){var J=K.data;var I=J[t];if(I==="true"){I='\u0056\u0065\u0072\u0064\u0061\u0064\u0065\u0069\u0072\u006f'}else{if(I==="false"){I='\u0046\u0061\u006c\u0073\u006f'}}return I}}else{if(A==="ddm-date"){u.inputFormatter=function(I){return f.map(I,function(K,J,L){return K.getTime()})};u.outputFormatter=function(I){return f.map(I,function(L,K,M){var J=new Date(j.toInt(L));J=i.add(J,i.MINUTES,J.getTimezoneOffset());return J})};E.formatter=function(L){var K=L.data;var J=K[t];if(J!==l){var I=new Date(j.toInt(J));I=i.add(I,i.MINUTES,I.getTimezoneOffset());J=g.DataType.Date.format(I)}return J}}else{if((A==="ddm-decimal")||(A==="ddm-integer")||(A==="ddm-number")){u.outputFormatter=function(J){var I=g.DataType.Number.parse(J);var K=l;if(j.isNumber(I)){K=I}return K};E.formatter=function(K){var J=K.data;var I=g.DataType.Number.parse(J[t]);if(!j.isNumber(I)){I=l}return I}}else{if(A==="ddm-documentlibrary"){E.formatter=function(M){var L=M.data;var J=l;var K=L[t];if(K!==l){var I=c.Util.parseJSON(K);if(I.title){J=I.title}}return J}}else{if(A==="ddm-link-to-page"){E.formatter=function(L){var K=L.data;var I=l;var J=K[t];if(J!==l){var M=c.Util.parseJSON(J);if(M.name){I=M.name}}return I}}else{if((A==="radio")||(A==="select")){B=p.findStructureFieldByAttribute(q,"name",t);var H=g.DataType.Boolean.parse(B.multiple);var G=p.getCellEditorOptions(B.options);E.formatter=function(L){var K=L.data;var I=[];var J=K[t];f.each(J,function(M,O,N){I.push(G[M])});return I.join(", ")};u.inputFormatter=f;u.multiple=H;u.options=G}else{if(A==="textarea"){E.allowHTML=true;E.formatter=function(K){var J=K.data;var I=J[t];if(!I){return I}return I.split("\n").join("<br>")}}}}}}}}var w=p.DATATYPE_VALIDATOR[D];var v=u.validator.rules;v[t]=g.mix({required:z},v[t]);if(w){v[t][w]=true}if(r&&E.editable){E.editor=new F(u)}});return s},buildEmptyRecords:function(q,s){var p=this;var t=[];for(var r=0;r<q;r++){t.push(p.getRecordModel(s))}return t},findStructureFieldByAttribute:function(p,q,r){var s=null;f.some(p,function(u,t,v){s=u;return(s[q]===r)});return s},getCellEditorOptions:function(p){var q={};f.each(p,function(s,r,t){q[s.value]=s.label});return q},getRecordModel:function(r){var p=this;var q={};f.each(r,function(t,s,u){q[t]=l});return q},updateRecord:function(r,q,u,t,s){var p=this;s=(s&&g.bind(s,p))||e;Liferay.Service("/ddlrecord/update-record",{recordId:r,displayIndex:q,fieldsMap:h.stringify(u),mergeFields:t,serviceContext:h.stringify({scopeGroupId:themeDisplay.getScopeGroupId(),userId:themeDisplay.getUserId(),workflowAction:Liferay.Workflow.ACTION_PUBLISH})},s)}});c.Util={getFileEntry:function(q,r){var p=this;q=p.parseJSON(q);Liferay.Service("/dlapp/get-file-entry-by-uuid-and-group-id",{uuid:q.uuid,groupId:q.groupId},r)},getFileEntryURL:function(r){var p=this;var q=[themeDisplay.getPathContext(),"documents",r.groupId,r.folderId,encodeURIComponent(r.title)];return q.join("/")},parseJSON:function(r){var p=this;var q={};try{q=JSON.parse(r)}catch(s){}return q}};c.TYPE_EDITOR["ddm-documentlibrary"]=k;c.TYPE_EDITOR["ddm-link-to-page"]=n;Liferay.SpreadSheet=c;var a={previewDialog:null,openPreviewDialog:function(r){var p=this;var q=p.previewDialog;if(!q){q=Liferay.Util.Window.getWindow({dialog:{bodyContent:r},title:'\u0050\u0072\u00e9\u002d\u0076\u0069\u0073\u0075\u0061\u006c\u0069\u007a\u0061\u0072'});p.previewDialog=q}else{q.show();q.set("bodyContent",r)}}};Liferay.DDLUtil=a},"",{requires:["aui-arraysort","aui-datatable","datatable-sort","json","liferay-portlet-url","liferay-util-window"]});